<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- CONFIGURATION ---
    const GITHUB_USERNAME = 'Sheringford'; // e.g., 'john-doe'
    const GITHUB_REPO = 'slub_besucherbuecher';     // e.g., 'transcription-project'
    const FOLDER_PATH = 'pages';            // The folder where your HTML pages live
    
    // We set a fallback in case the API limit is hit
    let totalPages = 5; 
    const CURRENT_PAGE = 2; // CHANGE THIS per page
    // ---------------------

    const indicator = document.getElementById('page-indicator');
    const select = document.getElementById('page-navigator');

    // Function to update the UI
    function updateNavigation(count) {
        // 1. Update text
        if (indicator) {
            indicator.textContent = `Page ${CURRENT_PAGE} of ${count}`;
        }

        // 2. Update Dropdown
        if (select) {
            select.innerHTML = ''; // Clear existing options
            for (let i = 1; i <= count; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `Go to Page ${i}`;
                if (i === CURRENT_PAGE) option.selected = true;
                select.appendChild(option);
            }
        }
    }

    // Initial load with fallback number
    updateNavigation(totalPages);

    // 3. FETCH REAL COUNT FROM GITHUB
    const apiUrl = `https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/${FOLDER_PATH}`;

    fetch(apiUrl)
        .then(response => {
            if (!response.ok) throw new Error('API limit or Repo not found');
            return response.json();
        })
        .then(data => {
            // Filter the results to only count .html files that look like "pageX.html"
            // This prevents counting random images or css files if they are in the folder
            const pageFiles = data.filter(file => 
                file.name.endsWith('.html') && file.name.startsWith('page')
            );
            
            totalPages = pageFiles.length;
            console.log(`Found ${totalPages} pages via GitHub API`);
            
            // Re-render the UI with the accurate count
            updateNavigation(totalPages);
        })
        .catch(error => {
            console.warn('Could not fetch page count from GitHub (using fallback):', error);
        });

    // 4. Setup Dropdown Event Listener
    if (select) {
        select.addEventListener('change', (e) => {
            window.location.href = `page${e.target.value}.html`;
        });
    }

    // 5. Setup Click-to-Zoom
    const images = document.querySelectorAll('.zoomable-image');
    images.forEach(img => {
        img.addEventListener('click', function() {
            this.classList.toggle('is-zoomed');
        });
    });
});
</script>